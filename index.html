<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å®¶ä¸­å°ç®¡å®¶ V2 - å…·å‚™å…Œæ›åŠŸèƒ½</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .btn-plus { @apply bg-emerald-500 active:bg-emerald-700 text-white p-3 rounded-lg shadow-sm text-sm font-medium; }
        .btn-minus { @apply bg-rose-500 active:bg-rose-700 text-white p-3 rounded-lg shadow-sm text-sm font-medium; }
        .btn-exchange { @apply bg-amber-500 text-white px-3 py-1 rounded-full text-xs font-bold shadow-md; }
        .card { @apply bg-white p-4 rounded-2xl shadow-sm mb-4 border border-gray-100; }
        /* è®“æ²è»¸ç¾åŒ– */
        #history-list::-webkit-scrollbar { width: 4px; }
        #history-list::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

<div id="app" class="max-w-md mx-auto min-h-screen p-4 pb-20">
    <header class="text-center my-6">
        <h1 class="text-2xl font-black text-slate-700 tracking-tight">ğŸ† æ¦®è­½é»æ•¸ç®¡ç†ç³»çµ±</h1>
    </header>

    <div class="flex p-1 bg-slate-200 rounded-xl mb-6">
        <button onclick="switchChild('wei')" id="tab-wei" class="flex-1 py-2 rounded-lg transition-all duration-300 font-bold">ç‘‹ç‘‹</button>
        <button onclick="switchChild('hao')" id="tab-hao" class="flex-1 py-2 rounded-lg transition-all duration-300 font-bold">è±ªè±ª</button>
    </div>

    <div class="card bg-gradient-to-br from-blue-600 to-indigo-700 text-white border-none shadow-indigo-200">
        <div class="flex justify-between items-center text-blue-100 text-sm mb-1">
            <span id="child-name-label">ç•¶å‰é¤˜é¡</span>
            <span class="opacity-80">è‡ªå‹•å„²å­˜ä¸­</span>
        </div>
        <div class="text-5xl font-black tracking-tighter" id="total-score">0</div>
    </div>

    <div class="card">
        <h3 class="font-bold text-slate-500 text-xs mb-3 uppercase tracking-widest">è¡Œç‚ºç™»è¨˜</h3>
        <div id="action-grid" class="grid grid-cols-2 gap-3">
            </div>
    </div>

    <div class="card">
        <h3 class="font-bold text-slate-500 text-xs mb-3 uppercase tracking-widest">çå‹µå…Œæ› (é»æ“Šå…Œæ›å°‡æ‰£åˆ†)</h3>
        <div id="reward-stack" class="space-y-3">
            </div>
    </div>

    <div class="card">
        <h3 class="font-bold text-slate-500 text-xs mb-3 uppercase tracking-widest">æœ€è¿‘ç´€éŒ„</h3>
        <div id="history-list" class="space-y-2 max-h-60 overflow-y-auto pr-1">
            </div>
    </div>

    <button onclick="clearHistory()" class="w-full py-4 text-slate-400 text-xs hover:text-rose-500 transition-colors">æ¸…é™¤æ‰€æœ‰æ­·å²ç´€éŒ„</button>
</div>

<script>
// 1. åŸºæœ¬è¨­å®š (ä¾ç…§åœ–ç‰‡è³‡è¨Š)
const config = {
    wei: {
        name: "ç‘‹ç‘‹",
        init: 16900,
        actions: [
            { t: "æº–æ™‚æ”¶å¹³æ¿", v: 500 }, { t: "å°è€ƒ > 80", v: 300 },
            { t: "æœŸä¸­æœ«è€ƒ > 80", v: 1000 }, { t: "æœŸä¸­æœ«è€ƒ 70-79", v: 500 },
            { t: "æœªæº–æ™‚æ”¶å¹³æ¿", v: -300 }, { t: "å«äº†æ²’é¦¬ä¸Šåš", v: -100 },
            { t: "å®¶äº‹æ²’åš", v: -500 }, { t: "ç„¡èŠè¬›å¼Ÿå¼Ÿ", v: -500 },
            { t: "è·Ÿå¼Ÿå¼Ÿåµæ¶", v: -500 }, { t: "åƒé£¯è¶…é20åˆ†", v: -300 }
        ],
        rewards: [
            { t: "300å…ƒç¦®ç‰©", v: 5000 }, { t: "500å…ƒç¦®ç‰©", v: 8000 }, { t: "ç­†è¨˜å‹é›»è…¦", v: 20000 }
        ]
    },
    hao: {
        name: "è±ªè±ª",
        init: 2150,
        actions: [
            { t: "å‡æ—¥ä¸è®“åª½ç”Ÿæ°£", v: 500 }, { t: "å¹³æ—¥ä¸è®“åª½ç”Ÿæ°£", v: 250 },
            { t: "æŒ‰æ‘©10åˆ†é˜", v: 100 }, { t: "å°è€ƒ > 85", v: 300 },
            { t: "æœŸä¸­æœ«è€ƒ > 85", v: 1000 }, { t: "è®“åª½å’ªç”Ÿæ°£", v: -100 },
            { t: "è·Ÿå“¥å“¥åµæ¶", v: -500 }, { t: "ç„¡èŠè¬›å“¥å“¥", v: -500 },
            { t: "å®¶äº‹æ²’åš", v: -500 }, { t: "å«äº†æ²’é¦¬ä¸Šåš", v: -100 },
            { t: "å°è€ƒ < 85", v: -200 }, { t: "æœŸä¸­æœ«è€ƒ < 85", v: -500 }
        ],
        rewards: [
            { t: "300å…ƒç¦®ç‰©", v: 5000 }, { t: "500å…ƒç¦®ç‰©", v: 8000 },
            { t: "å»æƒ³å»çš„åœ°æ–¹", v: 9000 }, { t: "è·Ÿåª½å’ªç¡ä¸€é€±", v: 10000 },
            { t: "æ™ºæ…§æ‰‹æ©Ÿ", v: 20000 }
        ]
    }
};

let currentID = 'wei';
// å¾ LocalStorage è®€å–è³‡æ–™ï¼Œå¦‚æœæ²’æœ‰å°±ç”¨åˆå§‹å€¼
let state = JSON.parse(localStorage.getItem('study_reward_v2')) || {
    wei: { score: config.wei.init, logs: [] },
    hao: { score: config.hao.init, logs: [] }
};

// åˆ‡æ›å°å­©
function switchChild(id) {
    currentID = id;
    const isWei = id === 'wei';
    document.getElementById('tab-wei').className = `flex-1 py-2 rounded-lg font-bold ${isWei ? 'bg-white shadow text-blue-600' : 'text-slate-500'}`;
    document.getElementById('tab-hao').className = `flex-1 py-2 rounded-lg font-bold ${!isWei ? 'bg-white shadow text-blue-600' : 'text-slate-500'}`;
    render();
}

// åŸ·è¡ŒåŠ æ¸›åˆ†
function addPoint(title, value) {
    state[currentID].score += value;
    addLog(currentID, `ã€ç™»è¨˜ã€‘${title}`, value);
    saveAndRefresh();
}

// åŸ·è¡Œå…Œæ› (è‡ªå‹•æ‰£åˆ†)
function exchange(title, cost) {
    if (state[currentID].score < cost) {
        alert("åˆ†æ•¸é‚„ä¸å¤ å–”ï¼Œç¹¼çºŒåŠ æ²¹ï¼");
        return;
    }
    if (confirm(`ç¢ºå®šè¦å…Œæ›ã€Œ${title}ã€ä¸¦æ‰£é™¤ ${cost} åˆ†å—ï¼Ÿ`)) {
        state[currentID].score -= cost;
        addLog(currentID, `ğŸ å…Œæ›äº†ï¼š${title}`, -cost);
        saveAndRefresh();
    }
}

// ç´€éŒ„æ—¥èªŒ
function addLog(id, msg, val) {
    const now = new Date();
    const timeStr = `${now.getMonth()+1}/${now.getDate()} ${now.getHours()}:${String(now.getMinutes()).padStart(2,'0')}`;
    state[id].logs.unshift({ time: timeStr, msg: msg, val: val });
    // æœ€å¤šä¿ç•™ 100 ç­†ç´€éŒ„
    if (state[id].logs.length > 100) state[id].logs.pop();
}

// å„²å­˜ä¸¦åˆ·æ–°ç•«é¢
function saveAndRefresh() {
    localStorage.setItem('study_reward_v2', JSON.stringify(state));
    render();
}

function render() {
    const data = state[currentID];
    const conf = config[currentID];
    
    // 1. åˆ†æ•¸
    document.getElementById('total-score').innerText = data.score.toLocaleString();
    document.getElementById('child-name-label').innerText = conf.name + " çš„ç•¶å‰é¤˜é¡";

    // 2. åŠ æ¸›åˆ†æŒ‰éˆ•
    const grid = document.getElementById('action-grid');
    grid.innerHTML = conf.actions.map(a => `
        <button onclick="addPoint('${a.t}', ${a.v})" class="${a.v > 0 ? 'btn-plus' : 'btn-minus'}">
            <div class="opacity-80 text-[10px] mb-1 font-normal">${a.v > 0 ? 'åŠ åˆ†' : 'æ‰£åˆ†'}</div>
            ${a.t}
            <div class="mt-1 text-lg font-black">${a.v > 0 ? '+' : ''}${a.v}</div>
        </button>
    `).join('');

    // 3. çå‹µå…Œæ›
    const stack = document.getElementById('reward-stack');
    stack.innerHTML = conf.rewards.map(r => {
        const canBuy = data.score >= r.v;
        return `
            <div class="flex justify-between items-center p-3 rounded-xl border ${canBuy ? 'bg-amber-50 border-amber-200' : 'bg-gray-50 border-gray-100 opacity-60'}">
                <div>
                    <div class="text-sm font-bold ${canBuy ? 'text-amber-800' : 'text-gray-500'}">${r.t}</div>
                    <div class="text-[10px] text-gray-400">éœ€ ${r.v.toLocaleString()} åˆ†</div>
                </div>
                ${canBuy ? `<button onclick="exchange('${r.t}', ${r.v})" class="btn-exchange">å…Œæ›</button>` : `<span class="text-[10px] text-gray-400">å°šå·® ${r.v - data.score}</span>`}
            </div>
        `;
    }).join('');

    // 4. æ­·å²ç´€éŒ„
    const list = document.getElementById('history-list');
    if (data.logs.length === 0) {
        list.innerHTML = `<div class="text-center py-4 text-slate-300 text-sm italic">å°šç„¡æ­·å²ç´€éŒ„</div>`;
    } else {
        list.innerHTML = data.logs.map(l => `
            <div class="flex justify-between items-center text-xs py-2 border-b border-slate-50">
                <div class="flex flex-col">
                    <span class="text-slate-400 scale-90 origin-left">${l.time}</span>
                    <span class="font-medium text-slate-600">${l.msg}</span>
                </div>
                <div class="font-bold ${l.val > 0 ? 'text-emerald-500' : 'text-rose-500'}">
                    ${l.val > 0 ? '+' : ''}${l.val}
                </div>
            </div>
        `).join('');
    }
}

function clearHistory() {
    if(confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ­·å²ç´€éŒ„å—ï¼Ÿï¼ˆåˆ†æ•¸æœƒä¿ç•™ï¼‰")) {
        state.wei.logs = [];
        state.hao.logs = [];
        saveAndRefresh();
    }
}

// åˆå§‹åŒ–
switchChild('wei');
</script>
</body>
</html>
