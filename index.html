<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kakao Reward System V3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #FEE500; }
        .ryan-card { @apply bg-white rounded-[30px] shadow-sm mb-4 border-none; }
        .btn-plus { @apply bg-[#E8F5E9] text-[#2E7D32] border-2 border-[#A5D6A7] rounded-2xl p-3 text-center active:scale-90 transition-all; }
        .btn-minus { @apply bg-[#FFEBEE] text-[#C62828] border-2 border-[#FFCDD2] rounded-2xl p-3 text-center active:scale-90 transition-all; }
        .btn-exchange { @apply bg-[#FFB6C1] text-white px-4 py-1 rounded-full text-sm font-bold shadow-sm active:bg-[#FF91A4] active:scale-95; }
        .tab-active { @apply bg-[#3C1E1E] text-white shadow-lg scale-105; }
        .tab-inactive { @apply bg-[#F7E600] text-[#3C1E1E] opacity-70; }
        #history-list::-webkit-scrollbar { width: 4px; }
        #history-list::-webkit-scrollbar-thumb { background: #FFD1D1; border-radius: 10px; }
    </style>
</head>
<body class="p-4 pb-10">

<div id="app" class="max-w-md mx-auto">
    <audio id="snd-plus" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
    <audio id="snd-minus" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3"></audio>
    <audio id="snd-exchange" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"></audio>

    <header class="flex items-center justify-center gap-2 my-6">
        <span class="text-3xl">ğŸ¦</span>
        <h1 class="text-2xl font-black text-[#3C1E1E]">å¥½å­©å­çå‹µæ¦œ</h1>
        <span class="text-3xl">ğŸ‘</span>
    </header>

    <div class="flex gap-2 mb-6 justify-center">
        <button onclick="switchChild('wei')" id="tab-wei" class="px-8 py-2 rounded-full font-black transition-all">ç‘‹ç‘‹</button>
        <button onclick="switchChild('hao')" id="tab-hao" class="px-8 py-2 rounded-full font-black transition-all">è±ªè±ª</button>
    </div>

    <div class="ryan-card p-6 text-center border-b-8 border-gray-100">
        <p class="text-[#3C1E1E] opacity-60 text-sm font-bold mb-1" id="child-label">ç•¶å‰åˆ†æ•¸</p>
        <div class="text-6xl font-black text-[#3C1E1E] tracking-tight" id="total-score">0</div>
        <div class="mt-2 inline-block px-3 py-1 bg-[#FEE500] rounded-full text-[10px] font-bold text-[#3C1E1E]">ğŸ”Š å·²é–‹å•ŸéŸ³æ•ˆå›é¥‹</div>
    </div>

    <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="ryan-card p-3 text-center">
            <h3 class="font-black text-xs text-[#2E7D32] mb-3">âœ¨ åŠ åˆ†</h3>
            <div id="plus-grid" class="flex flex-col gap-2"></div>
        </div>
        <div class="ryan-card p-3 text-center">
            <h3 class="font-black text-xs text-[#C62828] mb-3">âš ï¸ æ‰£åˆ†</h3>
            <div id="minus-grid" class="flex flex-col gap-2"></div>
        </div>
    </div>

    <div class="ryan-card p-5">
        <h3 class="font-black text-[#3C1E1E] text-sm mb-4">ğŸ ç¦®ç‰©å…Œæ›</h3>
        <div id="reward-stack" class="space-y-3"></div>
    </div>

    <div class="ryan-card p-5 bg-[#FFFAF0]">
        <h3 class="font-black text-gray-400 text-xs mb-3 uppercase tracking-widest">æœ€è¿‘ç™»è¨˜ç´€éŒ„</h3>
        <div id="history-list" class="space-y-2 max-h-48 overflow-y-auto"></div>
    </div>
</div>

<script>
const config = {
    wei: {
        name: "ç‘‹ç‘‹",
        init: 16900,
        actions: [
            { t: "è¡¨ç¾è‰¯å¥½", v: 100 }, { t: "æº–æ™‚æ”¶å¹³æ¿", v: 500 }, { t: "å°è€ƒ > 80", v: 300 },
            { t: "æœŸä¸­æœ«è€ƒ > 80", v: 1000 }, { t: "æœŸä¸­æœ«è€ƒ 70-79", v: 500 },
            { t: "æœªæº–æ™‚æ”¶å¹³æ¿", v: -300 }, { t: "å«äº†æ²’é¦¬ä¸Šåš", v: -100 },
            { t: "å®¶äº‹æ²’åš", v: -500 }, { t: "ç„¡èŠè¬›å¼Ÿå¼Ÿ", v: -500 },
            { t: "è·Ÿå¼Ÿå¼Ÿåµæ¶", v: -500 }, { t: "åƒé£¯è¶…é20åˆ†", v: -300 }
        ],
        rewards: [
            { t: "300å…ƒç¦®ç‰©", v: 5000 }, { t: "500å…ƒç¦®ç‰©", v: 8000 }, { t: "ç­†è¨˜å‹é›»è…¦", v: 20000 }
        ]
    },
    hao: {
        name: "è±ªè±ª",
        init: 2150,
        actions: [
            { t: "è¡¨ç¾è‰¯å¥½", v: 100 }, { t: "å‡æ—¥ä¸è®“åª½ç”Ÿæ°£", v: 500 }, { t: "å¹³æ—¥ä¸è®“åª½ç”Ÿæ°£", v: 250 },
            { t: "æŒ‰æ‘©10åˆ†é˜", v: 100 }, { t: "å°è€ƒ > 85", v: 300 },
            { t: "æœŸä¸­æœ«è€ƒ > 85", v: 1000 }, { t: "è®“åª½å’ªç”Ÿæ°£", v: -100 },
            { t: "è·Ÿå“¥å“¥åµæ¶", v: -500 }, { t: "ç„¡èŠè¬›å“¥å“¥", v: -500 },
            { t: "å®¶äº‹æ²’åš", v: -500 }, { t: "å«äº†æ²’é¦¬ä¸Šåš", v: -100 },
            { t: "å°è€ƒ < 85", v: -200 }, { t: "æœŸä¸­æœ«è€ƒ < 85", v: -500 }
        ],
        rewards: [
            { t: "300å…ƒç¦®ç‰©", v: 5000 }, { t: "500å…ƒç¦®ç‰©", v: 8000 },
            { t: "å»æƒ³å»çš„åœ°æ–¹", v: 9000 }, { t: "è·Ÿåª½å’ªç¡ä¸€é€±", v: 10000 },
            { t: "æ™ºæ…§æ‰‹æ©Ÿ", v: 20000 }
        ]
    }
};

let currentID = 'wei';
let state = JSON.parse(localStorage.getItem('kakao_reward_v3')) || {
    wei: { score: config.wei.init, logs: [] },
    hao: { score: config.hao.init, logs: [] }
};

function playSound(type) {
    const audio = document.getElementById('snd-' + type);
    audio.currentTime = 0;
    audio.play();
}

function switchChild(id) {
    currentID = id;
    document.getElementById('tab-wei').className = id === 'wei' ? 'px-8 py-2 rounded-full font-black tab-active' : 'px-8 py-2 rounded-full font-black tab-inactive';
    document.getElementById('tab-hao').className = id === 'hao' ? 'px-8 py-2 rounded-full font-black tab-active' : 'px-8 py-2 rounded-full font-black tab-inactive';
    render();
}

function addPoint(title, value) {
    state[currentID].score += value;
    playSound(value > 0 ? 'plus' : 'minus');
    addLog(currentID, title, value);
    save();
}

function exchange(title, cost) {
    if (state[currentID].score < cost) return;
    if (confirm(`ğŸ¦ ç¢ºèªè¦å…Œæ›ã€Œ${title}ã€å—ï¼Ÿ`)) {
        state[currentID].score -= cost;
        playSound('exchange');
        addLog(currentID, `ğŸ å…Œæ›ï¼š${title}`, -cost);
        save();
    }
}

function addLog(id, msg, val) {
    const now = new Date();
    const timeStr = `${now.getMonth()+1}/${now.getDate()} ${now.getHours()}:${String(now.getMinutes()).padStart(2,'0')}`;
    state[id].logs.unshift({ time: timeStr, msg: msg, val: val });
    if (state[id].logs.length > 50) state[id].logs.pop();
}

function save() {
    localStorage.setItem('kakao_reward_v3', JSON.stringify(state));
    render();
}

function render() {
    const data = state[currentID];
    const conf = config[currentID];
    document.getElementById('total-score').innerText = data.score.toLocaleString();
    document.getElementById('child-label').innerText = conf.name + " çš„ç•¶å‰åˆ†æ•¸";

    const plusGrid = document.getElementById('plus-grid');
    plusGrid.innerHTML = conf.actions.filter(a => a.v > 0).map(a => `
        <button onclick="addPoint('${a.t}', ${a.v})" class="btn-plus">
            <div class="text-[10px] font-bold">${a.t}</div>
            <div class="text-sm font-black">+${a.v}</div>
        </button>
    `).join('');

    const minusGrid = document.getElementById('minus-grid');
    minusGrid.innerHTML = conf.actions.filter(a => a.v < 0).map(a => `
        <button onclick="addPoint('${a.t}', ${a.v})" class="btn-minus">
            <div class="text-[10px] font-bold">${a.t}</div>
            <div class="text-sm font-black">${a.v}</div>
        </button>
    `).join('');

    const stack = document.getElementById('reward-stack');
    stack.innerHTML = conf.rewards.map(r => {
        const canBuy = data.score >= r.v;
        return `
            <div class="flex justify-between items-center p-3 rounded-2xl bg-gray-50 border ${canBuy ? 'border-[#FFB6C1] bg-[#FFF5F7]' : 'border-gray-100 opacity-50'}">
                <div>
                    <div class="text-xs font-black ${canBuy ? 'text-[#3C1E1E]' : 'text-gray-400'}">${r.t}</div>
                    <div class="text-[10px] text-gray-400 italic">${r.v.toLocaleString()} pt</div>
                </div>
                ${canBuy ? `<button onclick="exchange('${r.t}', ${r.v})" class="btn-exchange">å…Œæ›</button>` : `<div class="text-[9px] text-gray-300">å·® ${r.v - data.score}</div>`}
            </div>
        `;
    }).join('');

    const list = document.getElementById('history-list');
    list.innerHTML = data.logs.length === 0 ? `<div class="text-center py-4 text-gray-300 text-[10px]">å°šæœªæœ‰ç´€éŒ„</div>` : 
        data.logs.map(l => `
            <div class="flex justify-between items-center text-[10px] py-2 border-b border-gray-50">
                <span class="text-gray-400 font-mono scale-90">${l.time}</span>
                <span class="font-bold text-gray-600">${l.msg}</span>
                <span class="font-black ${l.val > 0 ? 'text-green-500' : 'text-red-400'}">${l.val > 0 ? '+' : ''}${l.val}</span>
            </div>
        `).join('');
}
switchChild('wei');
</script>
</body>
</html>
